{"id":57696,"date":"2012-04-26T19:17:20","date_gmt":"2012-04-26T19:17:20","guid":{"rendered":"http:\/\/pullmonkey.com\/?p=57696"},"modified":"2012-04-26T19:17:20","modified_gmt":"2012-04-26T19:17:20","slug":"headers-and-footers-in-rubys-spreadsheet-gem","status":"publish","type":"post","link":"http:\/\/pullmonkey.com\/2012\/04\/26\/headers-and-footers-in-rubys-spreadsheet-gem\/","title":{"rendered":"Headers and Footers in ruby&#8217;s Spreadsheet gem"},"content":{"rendered":"<p>Have you ever needed to add a header or footer to your spreadsheets in ruby?<br \/>\nYah, well, we have \ud83d\ude41<br \/>\nYes, you can do this with the <a href=\"https:\/\/rubygems.org\/gems\/writeexcel\">Write Excel gem<\/a>.<br \/>\nBut we've already written years worth of spreadsheet code with the <a href=\"https:\/\/rubygems.org\/gems\/spreadsheet\">spreadsheet gem<\/a> and don't want to rewrite it all.<\/p>\n<p>Anyway, we thought we'd share our little trick to get page headers using the spreadsheet gem.<\/p>\n<p><script src=\"https:\/\/gist.github.com\/2502027.js?file=gistfile1.rb\"><\/script><\/p>\n<p>So what you see here (above) goes into a config\/initializer, something like RAILS_ROOT\/config\/initializer\/enable_headers_in_spreadsheet_gem.rb.  Here's what's going on:<\/p>\n<p>1) We know that the <em>write_from_scratch<\/em> method is called when everything is said and done and the data is ready to be written to the spreadsheet file.  So we make use of this and alias that method to <em>write_from_scratch_without_header<\/em>.  Which opens us up to call our <em>write_header<\/em> method inside our <em>write_from_scratch<\/em> method which, of course, will call the original <em>write_from_scratch<\/em> method.<\/p>\n<p>2) Our <em>write_header<\/em> method makes use of the already existing opcode for Header in the spreadsheet gem.  It's not being used, so my guess is the developers intend on solving this issue at some point.  We have to send the opcode, the length info and the string we want to write out.  This was the trickiest part to figure out.<\/p>\n<p>3) We expose an add_header method that simply takes a string and stores it in the header accessor.  This means, to set the header, you simply say <em>sheet.add_header(\"foo header\")<\/em>.<\/p>\n<p>To implement the footer, you'd just do the same thing, create a footer accessor, add a method to update it.  Then build the <em>writer_footer<\/em> method with <em>opcode(:footer)<\/em> and append <em>write_footer<\/em> at the end of <em>write_from_scratch<\/em>.<\/p>\n<p>Well, that took us some time to figure out, so enjoy and let me know if you have any questions.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Have you ever needed to add a header or footer to your spreadsheets in ruby? Yah, well, we have \ud83d\ude41 Yes, you can do this with the Write Excel gem. But we&#8217;ve already written years worth of spreadsheet code with the spreadsheet gem and don&#8217;t want to rewrite it all. Anyway, we thought we&#8217;d share [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[118,6,51,5,9,30],"tags":[182,184,181,183,185,210,211,45],"_links":{"self":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/57696"}],"collection":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/comments?post=57696"}],"version-history":[{"count":4,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/57696\/revisions"}],"predecessor-version":[{"id":57700,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/57696\/revisions\/57700"}],"wp:attachment":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/media?parent=57696"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/categories?post=57696"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/tags?post=57696"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
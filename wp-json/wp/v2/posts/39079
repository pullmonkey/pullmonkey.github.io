{"id":39079,"date":"2008-04-21T14:53:00","date_gmt":"2008-04-21T14:53:00","guid":{"rendered":"\/2008\/04\/21\/ruby-on-rails-multiple-database-connections"},"modified":"2009-08-30T04:43:31","modified_gmt":"2009-08-30T04:43:31","slug":"ruby-on-rails-multiple-database-connections","status":"publish","type":"post","link":"http:\/\/pullmonkey.com\/2008\/04\/21\/ruby-on-rails-multiple-database-connections\/","title":{"rendered":"Ruby on Rails &#8211; Multiple database connections"},"content":{"rendered":"<p>Found a need for this information while answering questions on railsforum.<br \/>\nSo, let's say that we want to use two databases and let's even say that we want to use an Oracle database and a MySQL database.  How can this be done?  To start, we must decide which database will be our default database.  In this scenario, I chose MySQL.  Let's see what that looks like:<\/p>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt>4<tt>\n<\/tt><strong>5<\/strong><tt>\n<\/tt>6<tt>\n<\/tt>7<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\"><span class=\"c\"># in your database.yml file<\/span><tt>\n<\/tt>development:<tt>\n<\/tt>  adapter: mysql<tt>\n<\/tt>  username: root<tt>\n<\/tt>  password: <tt>\n<\/tt>  database: example_development<tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>So we have all seen that before.  Now all of our active record models will use this mysql connection.<br \/>\nBut, I need to use data from an oracle database, so let's setup that connection:<\/p>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt>4<tt>\n<\/tt><strong>5<\/strong><tt>\n<\/tt>6<tt>\n<\/tt>7<tt>\n<\/tt>8<tt>\n<\/tt>9<tt>\n<\/tt><strong>10<\/strong><tt>\n<\/tt>11<tt>\n<\/tt>12<tt>\n<\/tt>13<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\"><span class=\"c\"># in your database.yml file<\/span><tt>\n<\/tt>development:<tt>\n<\/tt>  adapter: mysql<tt>\n<\/tt>  username: root<tt>\n<\/tt>  password: <tt>\n<\/tt>  database: example_development<tt>\n<\/tt><tt>\n<\/tt>oracle_development:<tt>\n<\/tt>  adapter: oracle<tt>\n<\/tt>  username: root<tt>\n<\/tt>  password: <tt>\n<\/tt>  database: example_oracle_development<tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>Neat, we have two development connections.  Now we have to tell which models to use which connection.  Well, actually, we just need to tell the oracle models to connect to oracle_development, all the other models will default to development.  I have a model named user, and it's records are kept in an oracle database.  Our user model looks like this initially:<\/p>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt>4<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\"><span class=\"c\">#RAILSROOT\/app\/models\/user.rb<\/span><tt>\n<\/tt><span class=\"r\">class<\/span> <span class=\"cl\">User<\/span> &lt; <span class=\"co\">ActiveRecord<\/span>::<span class=\"co\">Base<\/span> <tt>\n<\/tt><span class=\"r\">end<\/span><tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>The line we need to add is this:<\/p>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\">establish_connection <span class=\"sy\">:oracle_development<\/span><tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>Even better, we can make this dynamic, so when we are in the test or production environment, we don't need to change the establish_connection line.<\/p>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\"><span class=\"c\"># use RAILS_ENV where RAILS_ENV is generally development, test or production<\/span><tt>\n<\/tt>establish_connection <span class=\"s\"><span class=\"dl\">&quot;<\/span><span class=\"k\">oracle_<\/span><span class=\"il\"><span class=\"dl\">#{<\/span><span class=\"co\">RAILS_ENV<\/span><span class=\"dl\">}<\/span><\/span><span class=\"dl\">&quot;<\/span><\/span><tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>So the final product could look something like this:<\/p>\n<h3>database.yml<\/h3>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt>4<tt>\n<\/tt><strong>5<\/strong><tt>\n<\/tt>6<tt>\n<\/tt>7<tt>\n<\/tt>8<tt>\n<\/tt>9<tt>\n<\/tt><strong>10<\/strong><tt>\n<\/tt>11<tt>\n<\/tt>12<tt>\n<\/tt>13<tt>\n<\/tt>14<tt>\n<\/tt><strong>15<\/strong><tt>\n<\/tt>16<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\">dev_basics: &amp;dev_basics<tt>\n<\/tt>  username: root<tt>\n<\/tt>  password: <tt>\n<\/tt><tt>\n<\/tt>&lt;% <span class=\"s\"><span class=\"dl\">%w(<\/span><span class=\"k\">development test production<\/span><span class=\"dl\">)<\/span><\/span>.each <span class=\"r\">do<\/span> |env| <span class=\"s\"><span class=\"dl\">%&gt;<\/span><span class=\"k\"><tt>\n<\/tt>&lt;%= env %<\/span><span class=\"dl\">&gt;<\/span><\/span>:<tt>\n<\/tt>  &lt;&lt;: *dev_basics<tt>\n<\/tt>  adapter: mysql<tt>\n<\/tt>  database: example_&lt;%= env <span class=\"s\"><span class=\"dl\">%&gt;<\/span><span class=\"k\"><tt>\n<\/tt><tt>\n<\/tt>oracle_&lt;%= env %<\/span><span class=\"dl\">&gt;<\/span><\/span>:<tt>\n<\/tt>  &lt;&lt;: *dev_basics<tt>\n<\/tt>  adapter: oracle<tt>\n<\/tt>  database: example_oracle_&lt;%= env <span class=\"s\"><span class=\"dl\">%&gt;<\/span><span class=\"k\"><tt>\n<\/tt>&lt;% end %<\/span><span class=\"dl\">&gt;<\/span><\/span><tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<h3>Oracle model example<\/h3>\n<table class=\"CodeRay\">\n<tr>\n<td class=\"line_numbers\" title=\"click to toggle\" onclick=\"with (this.firstChild.style) { display = (display == '') ? 'none' : '' }\">\n<pre>1<tt>\n<\/tt>2<tt>\n<\/tt>3<tt>\n<\/tt>4<tt>\n<\/tt><\/pre>\n<\/td>\n<td class=\"code\">\n<pre ondblclick=\"with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }\"><span class=\"r\">class<\/span> <span class=\"cl\">User<\/span> &lt; <span class=\"co\">ActiveRecord<\/span>::<span class=\"co\">Base<\/span> <tt>\n<\/tt>  establish_connection <span class=\"s\"><span class=\"dl\">&quot;<\/span><span class=\"k\">oracle_<\/span><span class=\"il\"><span class=\"dl\">#{<\/span><span class=\"co\">RAILS_ENV<\/span><span class=\"dl\">}<\/span><\/span><span class=\"dl\">&quot;<\/span><\/span><tt>\n<\/tt><span class=\"r\">end<\/span><tt>\n<\/tt><tt>\n<\/tt><\/pre>\n<\/td>\n<\/tr>\n<\/table>\n<p>\nThat should be it.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Found a need for this information while answering questions on railsforum. So, let&#8217;s say that we want to use two databases and let&#8217;s even say that we want to use an Oracle database and a MySQL database. How can this be done? To start, we must decide which database will be our default database. In [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[6,3,5,9,30],"tags":[54,64,210,211,43],"_links":{"self":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/39079"}],"collection":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/comments?post=39079"}],"version-history":[{"count":1,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/39079\/revisions"}],"predecessor-version":[{"id":57358,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/posts\/39079\/revisions\/57358"}],"wp:attachment":[{"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/media?parent=39079"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/categories?post=39079"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/pullmonkey.com\/wp-json\/wp\/v2\/tags?post=39079"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}